---
title: "SQL in R"
author: "Jessica Jagdeo"
date: "3/12/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      message = FALSE,
                      warning = FALSE,
                      connection = "lter_db")

library(tidyverse)
library(here)
library(DBI)
library(RSQLite)
```

### 1. Connect to the database and tell R that we're using SQLite:

```{r}

lter_db <- DBI::dbConnect(drv = RSQLite::SQLite(),
                          dbname = here("data", "marine.sqlite")) 

# Tells R what engine you're going to use when doing SQL querying (SQLite) and tells us what database to connect to (marine.sqlite)

```

### 2. What tables exist in the database?

To check which tables exist (table names) in a database, use 'DBI::dbListTables()':

```{r}

DBI::dbListTables(lter_db)

# Tables are fish_data, inverts_data, and lobsters_data

```

### 3. Which variables are in a database table?

Use 'DBI::dbListFields()':

```{r}

DBI::dbListFields(lter_db, "fish_data")

# Column names for fish_data are year, site, common_name, and total_count

```

```{r}

DBI::dbListFields(lter_db, "inverts_data")

# Column names are month, site, common_name, 2016, 2017, 2018

```

#### Read in a database table as an R data frame

Use 'DBI::dbReadTable()':

```{r}

fish_df <- DBI::dbReadTable(lter_db, "fish_data")
class(fish_df) # Check to see if it's a data frame

```

#### Query a database using SQL

- SELECT: Gets columns
- FROM: What table in a database to get something from
- Use * to indicate "get all"

```{sql connection=lter_db}

SELECT * FROM fish_data

```

To get a subset of the columns, we can just list them after SELECT, separated by a comma:

```{sql connection=lter_db}

SELECT year, site FROM fish_data

```

